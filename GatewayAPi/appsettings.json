{
  "ReverseProxy": {
    "Routes": {
      "route-api": {
        "ClusterId": "cluster-api",
        "Match": {
          "Path": "/api/{**catch-all}"
        },
        "Transforms": [
          { "RequestHeaderOriginalHost": "true" },
          {
            "RequestHeader": "X-UserId",
            "Set": "{claims:sub}"
          },
          {
            "RequestHeader": "X-Role",
            "Set": "{claims:role}"
          },
          {
            "RequestHeader": "Authorization",
            "Set": "{httpRequestHeader:Authorization}"
          },
          {
            "RequestHeader": "X-Request-ID",
            "Set": "{httpRequestHeader:X-Request-ID}"
          }
        ]
      }
    },

    "Clusters": {
      "cluster-api": {
        "LoadBalancingPolicy": "RoundRobin",
        "Destinations": {
          "backend1": { "Address": "https://backend1.local:5001/" },
          "backend2": { "Address": "https://backend2.local:5001/" }
        }
      }
    }
  },

  "Redis": {
    "Configuration": "LocalHost:6379"
  },

  "RateLimit": {
    "WindowSeconds": 60,
    "MaxRequestsPerWindow": 20
  },

  "Serilog": {
    "Using": [ "Serilog.Sinks.PostgreSQL" ],
    "MinimumLevel": "Information",
    "WriteTo": [
      {
        "Name": "Console"
      },
      {
        "Name": "PostgreSQL",
        "Args": {
          "connectionString": "Host=localhost;Port=5432;Database=neo;Username=postgres;Password=postgres;SSL Mode=Disable;Trust Server Certificate=true",
          "tableName": "Logs",
          "needAutoCreateTable": true,
          "columnOptionsSection": {
            "additionalColumns": [
              {
                "ColumnName": "request_id",
                "DataType": "Text",
                "AllowNull": true
              }
            ]
          },
          "columnWriters": {
            "request_id": {
              "Name": "RequestId",
              "WriteMethod": "Raw"
            }
          }
        }
      }
    ],
    "Enrich": [ "FromLogContext", "WithMachineName" ],
    "Properties": {
      "Application": "GatewayAPI"
    }
  }
}
